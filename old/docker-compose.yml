# Vers√£o do Docker Compose
version: '3.8'

# ==============================================================================
# üê≥ ARQUIVO DE CONFIGURA√á√ÉO DOCKER COMPOSE ‚Äì PROJETO ATLAS
#
# Este arquivo define os servi√ßos, redes e volumes para o ambiente de
# desenvolvimento local do Atlas, utilizando Supabase para banco de dados
# e armazenamento de objetos.
#
# Para iniciar os servi√ßos locais:
# $ docker-compose up -d
#
# Para parar os servi√ßos:
# $ docker-compose down
# ==============================================================================

services:
  # --- BANCO DE DADOS DE GRAFO (LOCAL) ---
  neo4j:
    image: neo4j:5.13 # Imagem oficial do Neo4j
    container_name: atlas_neo4j
    restart: unless-stopped
    environment:
      - NEO4J_AUTH=neo4j/atlas_password # Usu√°rio/senha
    ports:
      - "7474:7474" # Interface HTTP
      - "7687:7687" # Porta Bolt para conex√£o de drivers
    volumes:
      - neo4j_data:/data
    networks:
      - atlas_net

  # --- API DE CONSULTA (LOCAL) ---
  api:
    build:
      context: ./src/api
    container_name: atlas_api
    restart: unless-stopped
    env_file:
      - .env
    ports:
      - "8000:8000"
    depends_on:
      - neo4j
    networks:
      - atlas_net

  # --- WORKER DE INGEST√ÉO/ETL (LOCAL) ---
  # Este worker agora se conecta ao Supabase, conforme definido no .env
  worker:
    build:
      context: .
      dockerfile: src/worker/Dockerfile
    container_name: atlas_worker
    env_file:
      - .env
    depends_on:
      - neo4j
    networks:
      - atlas_net
    # As vari√°veis de ambiente para conex√£o com o banco de dados
    # s√£o lidas a partir do arquivo .env pelos pr√≥prios scripts.

# --- VOLUMES PARA PERSIST√äNCIA DE DADOS (APENAS SERVI√áOS LOCAIS) ---
volumes:
  neo4j_data:
    driver: local

# --- REDE PARA COMUNICA√á√ÉO ENTRE SERVI√áOS LOCAIS ---
networks:
  atlas_net:
    driver: bridge
